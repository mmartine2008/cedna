<script>
    var formulario = <?= $formulario ?>;

    function createListFromJSONLista(selector, lista, divElement) {
        var option = document.createElement("option");
        option.value =  -1;
        option.text = 'Seleccione';
        selector.appendChild(option);

        for (var i=0; i < lista.length; i++) {
            var item = lista[i];
            var option = document.createElement("option");
            option.value = item.descripcion;
            option.text = item.descripcion;
            selector.appendChild(option);
        }
        divElement.appendChild(selector);
    }

    function createSelector(opciones, divElement) {
        
        var selector = document.createElement("select");

        createListFromJSONLista(selector, opciones, divElement);

    }
    function createInput(divElement){
        ele = document.createElement('input');
        ele.type = 'text';
        ele.name = 'respuesta'.i;
        divElement.appendChild(ele);
    }    

    function crearPreguntas(item, divElement){
        preguntas = item.preguntas;
        for (var i = 0; i < preguntas.length; i++){
            var item = preguntas[i];
            var pregunta = document.createElement("P");
            var text = document.createTextNode(item.descripcion);
            pregunta.appendChild(text);
            divElement.appendChild(pregunta);
            if (item.cerrada == '0'){
                var opciones = item.opciones;
                createSelector(opciones, divElement);
            } else {
                createInput(divElement);
            }
        }
    }

    function crearItemSeccion(item, contenedor){

        // Creating a div element
        var divElement = document.createElement("Div");
        divElement.id = "secciones";

        // Styling it
        divElement.style.textAlign = "lefth";
        // divElement.style.fontWeight = "bold";
        // divElement.style.fontSize = "smaller";
        divElement.style.paddingTop = "15px";

        // Adding a paragraph to it
        var paragraph = document.createElement("P");
        var text = document.createTextNode(item.nombre);
        paragraph.appendChild(text);
        divElement.appendChild(paragraph);

        crearPreguntas(item, divElement);

        // Appending the div element to body
        contenedor.appendChild(divElement);
            
        return divElement;
    }

    function construirSecciones(childs, contenedor){
        var paragraph = document.createElement("P");
        var text = document.createTextNode(formulario.descripcion);
        paragraph.appendChild(text);
        contenedor.appendChild(paragraph);

        for (var i = 0; i < childs.length; i++){
            var item = childs[i];

            var itemSeccion = crearItemSeccion(item, contenedor);
            contenedor.appendChild(itemSeccion);
        }
    }

    function crearFormulario(){
        construirSecciones(formulario.secciones, document.getElementsByTagName("div")[0]);
    }

    crearFormulario();
</script>
